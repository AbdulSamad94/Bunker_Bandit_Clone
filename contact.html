<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-i18n="contact_title">Kontakt</title>
  <link rel="stylesheet" href="assets/css/default.css" />
  <link rel="stylesheet" href="assets/css/contact.css" />
  <link rel="stylesheet" href="assets/css/language-switcher.css" />
</head>

<body>
  <div id="header"></div>

  <main>
    <form class="contact-form">
      <div class="inputs-div">
        <label data-i18n="name_label">Name</label>
        <input type="text" name="name" data-i18n-placeholder="name_placeholder" placeholder="Dein Name" required />
      </div>

      <div class="inputs-div">
        <label data-i18n="email_label">E-Mail</label>
        <input type="email" name="email" data-i18n-placeholder="email_placeholder" placeholder="deine@email.de"
          required />
      </div>

      <div class="inputs-div">
        <label data-i18n="subject_label">Betreff</label>
        <select name="subject" required>
          <option value="" data-i18n="subject_default">
            Wähle einen Betreff
          </option>
          <option value="Booking Anfrage" data-i18n="subject_booking">
            Booking Anfrage
          </option>
          <option value="Press & Media" data-i18n="subject_press">
            Press & Media
          </option>
          <option value="Fan Mail" data-i18n="subject_fanmail">
            Fan Mail
          </option>
          <option value="Sonstiges" data-i18n="subject_other">
            Sonstiges
          </option>
        </select>
      </div>

      <div class="inputs-div">
        <label data-i18n="message_label">Nachricht</label>
        <textarea name="message" data-i18n-placeholder="message_placeholder" placeholder="Deine Nachricht an uns"
          required></textarea>
      </div>

      <button type="submit" data-i18n="submit_button" disabled id="submit-btn">Nachricht Senden</button>
      <div id="loading-message" style="display: none; margin-top: 10px; color: #666;">Sending email...</div>
    </form>
  </main>

  <footer id="footer"></footer>

  <script src="/assets/scripts/language-switcher.js"></script>
  <script src="assets/scripts/component.js" defer></script>
  <script>
    const form = document.querySelector('.contact-form');
    const submitBtn = document.getElementById('submit-btn');
    const loadingMessage = document.getElementById('loading-message');

    // Enable submit button when form is ready
    form.addEventListener('input', () => {
      const name = form.querySelector('input[name="name"]').value.trim();
      const email = form.querySelector('input[name="email"]').value.trim();
      const subject = form.querySelector('select[name="subject"]').value;
      const message = form.querySelector('textarea[name="message"]').value.trim();

      submitBtn.disabled = !(name && email && subject && message);
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = form.querySelector('input[name="name"]').value.trim();
      const email = form.querySelector('input[name="email"]').value.trim();
      const subject = form.querySelector('select[name="subject"]').value;
      const message = form.querySelector('textarea[name="message"]').value.trim();

      if (!name || !email || !subject || !message) {
        alert('Bitte fülle alle Felder aus.');
        return;
      }

      // Show loading state
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending...';
      loadingMessage.style.display = 'block';

      try {
        // Use relative URL - will work both locally and on Vercel
        const apiUrl = window.location.hostname === 'localhost'
          ? 'https://bunker-bandit-clone.vercel.app/api/send-email'
          : 'https://bunker-bandit-clone.vercel.app/api/send-email';

        const res = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, subject, message }),
        });

        const data = await res.json();

        if (res.ok && data.success) {
          alert('Email successfully sent.');
          form.reset();
          submitBtn.disabled = true;
        } else {
          alert(`Failed to send email: ${data.error || 'Unknown error'}`);
        }
      } catch (err) {
        console.error('Error:', err);
        alert('Server error. Please try again later.');
      } finally {
        // Reset button state
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Message';
        loadingMessage.style.display = 'none';
      }
    });
  </script>
</body>

</html>